# ShopCalc Pro
ShopCalc Pro is a further development of its predecessor, **ShopCalc** (see [ShopCalc GitHub by If4x](https://github.com/If4x/ShopCalc)).  
While ShopCalc focused on being usable out of the box without the need for additional modules other than the ESP32, this restriction led to performance issues when the shop size increased to the point where EEPROM storage (400 bytes in size) would run out. On top of that, the ESP32's EEPROM has very limited write cycles, which could result in total failure during an event if used long-term.  
To address these issues and open up possibilities for future features, a simple SD module is now connected to the ESP32 via SPI.

This is a simple, web-based shop calculator running on the ESP32. It's designed to serve as a basic calculator for school events to optimize the selling process, save time, and minimize calculation errors (which happen more often than one might think when the task is done manually by younger students). It's platform-independent, meaning it runs on all mobile devices (e.g., iOS, Android, ...).

>[!CAUTION]
> This is a DIY project. Although the skills required to replicate this project are considered to be fairly low for people that have handled electronics before, this might still be complicated to unexperienced people. be careful to not burn yourself when soldering and check for short circuits (e.g. with a powerbank) before connecting the ESP32 to your computer again to prevent damage to your computer.

# Parts needed
- ESP32-Dev
- Basic SPI Micro-SD-Module
- Micro-SD-Card (recommended 2-8GB since those are cheap but even 2GB is overkill, tested and works with 2GB-32GB)

# Skills needed
- Being able to type on a computer without breaking your fingers
- Being able to hold a sottering iron in a way that you don't end up cooking your fingers well done
- Being able to read these instructions

# Features
**General**  
- Extremely low power consumption (0.7W), allowing the system to run for days on a standard-sized power bank.  
- Easy and intuitive to use (seriously, if you can navigate a browser, you can use this).  
- Utilizes onboard components and an SD module to keep things as simple and easy to build as possible.

**Product Page** (192.168.4.1)  
<img src="https://github.com/If4x/SopCalc-Pro/blob/main/UI/Shop_page.PNG?raw=true" alt="Image of shop page" height="600">
- Allows the user to select products ordered by customers.  
- Buttons for +1, +2, +3 to speed up input.  
- Color-coded buttons for adding/removing items from the cart for easy and intuitive interaction.  
- Order submit (saves the order to statistics).  
- Order delete (in case of "oops, I made a big mistake," and deleting everything is faster).  
- Displays the specific quantity of ordered items.  
- Displays the total amount.  
- Displays the included deposit for glasses and bottles (default: 1€).

**Configuration Page** (192.168.4.1:8080)  
<img src="https://github.com/If4x/SopCalc-Pro/blob/main/UI/Config_page.PNG?raw=true" alt="Image of config page" height="600">
- Edit products (name, price, deposit).  
- Delete products (in case they are no longer used or outdated).  
- Create new products.
- Reset the products to default products.

**Sales Page** (192.168.4.1/sales)  
<img src="https://github.com/If4x/SopCalc-Pro/blob/main/UI/Sales_page.PNG?raw=true" alt="Image of sales page" height="600">
- Displays total items sold.  
- Option to export the statistics for later use.  
- Reset statistics (before or after an event to get accurate results).

**Additional 3D-Printed Case (COMING SOON)**  
There will be STL files for an additional ESP case with buttons for **EN** and **BOOT** to restart the ESP32. It also includes "air vents" for the processor due to heat generated by the active use of the Wi-Fi module and houses the SD card module.

**Error Codes and troubleshooting**  
The onboard LED of the ESP is primarily used as a status LED, blinking briefly every second. However, it also serves as a visual indicator if something went wrong, blinking a specific number of times to signal the error.

| # of blinks | ERROR                                 |
|-------------|---------------------------------------|
| 1           | SD not found                          |
| 2           | SD found but unable to initialize     |
| 3           | SD unable to mount                    |
| 4           | File error read/write                 |
| 10          | Unknown Error, check Serial Monitor   |

When prblem cannot befixed by rebooting (EN button) or powercycling, Check Serial monitor with the [reader script](https://github.com/If4x/SopCalc-Pro/blob/main/serial_reader/reader.py). Adjust the COM Port to your needs. The ESP sends all actions it's doing and if they are/aren't successful to the serial monitor for troubleshooting. Additionally, the serial output is colorcoded for better redability and incsreased efficiency while troubleshooting.
<img src="https://github.com/If4x/SopCalc-Pro/blob/main/UI/Serial_troubleshooting.png?raw=true" alt="Image of serial output while troubleshooting" width="600">

# Setup
The system is intended to run on the **ESP32-Dev**. It uses onboard components and a basic/standard Micro-SD module to minimize the required technical skills to nearly zero.

**Building and Soldering**
Pin connections. (recommended to be soldered)
| Pin on ESP32 | Pin on SD Module      |
|--------------|-----------------------|
| VIN/5V       | VCC                   |
| GND          | GND                   |
| D5           | CS                    |
| D18          | CLK                   |
| D19          | MISO                  |
| D23          | MOSI                  |

Important: Keep in mind that the cables have to be long enogh to be able to "fold" the SD module on the back of the ESP32 but also short enogh so that they can fit into the case.

The case can be printed from the stl files in the case folder [here](https://github.com/If4x/SopCalc-Pro/tree/main/case). The folder also includes pictures for assembly and orientation.
There are two versions of the case:
1. Basic Version. Just the Case that fits the two covers. Works perfectly fine
2. Keychain Version. Has a hole to add a keychain of your choice. Ideal if the System is transported a lot, not as easy to loose.

Recommended Print settings:
- 3 Wall-lines
- 4 Layers bottom and top
- 15% Infil (Pattern of your choice)
- Support (recommended using organic support, worked the best for me)
- No brim

**Completed Assembly**
![Image of complete assembly](https://github.com/If4x/SopCalc-Pro/blob/main/case/Full%20assembly.JPEG)


**First Power-up**  
1. Plug the SD card into the SD module.  
2. Connect the ESP32-Dev to your computer.  
3. Flash `main.cpp` to the ESP32-Dev (we recommend using PlatformIO for quick compilation; Arduino IDE works too, but it's slower).  
4. Connect your smartphone to Wi-Fi (SSID: **Kasse** | Password: **BitteGeld**). This can be modified in the `main.cpp` file at the beginning.  
5. Open your browser and type `192.168.4.1:80` in the search bar to access the shop page.  
   For the sales overview page, type `192.168.4.1/sales`. Here you can export your sales data for statistical use.  
   For the configuration page, type `192.168.4.1:8080`.  
   And you're done! Simple as that!  
   Now, your system is ready to go. It has created the configuration files on the SD card, so it will store the product list and sold units even after power is disconnected from the ESP.

**After First Power-up**  
1. Plug the SD card into the SD module.  
2. Connect the ESP32-Dev to power.  
3. Connect to Wi-Fi (if not modified, the default connection is as described in the First Power-up steps).  
4. Open your browser and type `192.168.4.1` to access the shop page.  
   For the configuration page, type `192.168.4.1:8080`.  
   For the sales overview page, type `192.168.4.1/sales`.  
   And again, you're done! Super easy!

# Limitations
Now that the system uses an SD card, there are basically no limits on how many products you can have in your store (but seriously, if you manage to fill a 2GB card just with products, you might want to reconsider your life choices—or maybe just upgrade to something more professional instead of using this piece of "garbage").  
**However**, to improve performance, the following limitations have been set in the code (and can be changed to meet your needs):  
- **MAX_PRODUCTS** is set to 50 but can be increased for a larger store.  
- **name[50]** limits the length of product names for better readability. It is not recommended to increase this much further, as the usability of the system would decrease significantly.

# Coming Soon
- ESP configuration (Wi-Fi password, name, etc.) saved to a file on the SD card. This would allow someone to create default config files, save them to the SD card, and apply them without modifying the code, enabling even the most inexperienced microcontroller users to make changes to the ESP config.  
- Users log to log who sold what. (Statistical usage)
